# SQL Query Optimization Chatbot 🤖

Gradio 기반 대화형 SQL 쿼리 최적화 학습 챗봇입니다.

## 기능

- 📝 **문제 출제**: 비효율적인 SQL 쿼리를 제시하고 최적화 과제 제공
- ✅ **자동 채점**: 제출한 쿼리를 실행하고 정확성과 성능을 평가
- 📊 **성능 분석**: 비효율적 쿼리, 사용자 쿼리, 최적 쿼리의 실행 시간 비교
- 💡 **실시간 피드백**: 쿼리 결과, 성능, 개선 방향에 대한 상세 피드백
- 🎯 **정답 제공**: 막힐 때 모범 답안과 해설 확인

## 설치 및 실행

### 1. 의존성 설치

```bash
# uv sync로 자동 설치
uv sync

# 또는 pip로 설치
pip install gradio
```

### 2. Gradio 챗봇 실행

```bash
# uv run 사용 (권장)
uv run python app.py

# 또는 가상환경 활성화 후 실행
source .venv/bin/activate  # Windows: .venv\Scripts\activate
python app.py
```

### 3. 웹 브라우저에서 접속

서버가 시작되면 브라우저에서 다음 주소로 접속:
- 로컬: http://localhost:7860
- 네트워크: http://0.0.0.0:7860

## 사용 방법

### 1단계: 문제 선택
- 문제 목록에서 원하는 문제를 선택합니다
- 비효율적인 쿼리와 최적화 과제가 표시됩니다

### 2단계: 쿼리 작성
- SQL 입력창에 최적화된 쿼리를 작성합니다
- 제공된 힌트를 참고하세요

### 3단계: 제출 및 채점
- "제출 및 채점" 버튼을 클릭합니다
- 실시간으로 쿼리가 실행되고 채점됩니다

### 4단계: 피드백 확인
채점 결과에는 다음 정보가 포함됩니다:
- ✅/❌ 정답 여부
- 📊 실행 시간 비교
- 🎯 성능 점수 (100점 만점)
- 💡 개선 팁

### 추가 기능
- **정답 보기**: 막힐 때 모범 답안과 해설 확인
- **초기화**: 처음부터 다시 시작

## 문제 목록

### Problem 1: 불필요한 JOIN과 중복 서브쿼리 제거
**학습 목표:**
- CTE(WITH 절) 활용
- 중복 JOIN 제거
- 필요한 컬럼만 SELECT
- LEFT JOIN vs INNER JOIN

**난이도:** ⭐⭐⭐

### Problem 2: 비효율적인 GROUP BY 최적화
**학습 목표:**
- 불필요한 테이블 JOIN 제거
- 서브쿼리 대신 집계 함수 활용
- COUNT DISTINCT 사용
- GROUP BY 성능 최적화

**난이도:** ⭐⭐⭐⭐

## 채점 기준

### 정확성 (필수)
- ✅ 쿼리가 올바른 결과를 반환하는지 확인
- ✅ 행 개수가 정답과 일치하는지 확인
- ✅ 데이터 내용이 정답과 일치하는지 확인

### 성능 점수 (100점 만점)
- 🌟 **100점**: 비효율적 쿼리 대비 1.5배 이상 빠름
- ✅ **90점**: 비효율적 쿼리 대비 1.2배 이상 빠름
- 👍 **80점**: 비효율적 쿼리 대비 1.0배 이상 빠름
- ⚠️ **70점**: 비효율적 쿼리보다 느림

## 파일 구조

```
sql101/
├── app.py                    # Gradio 웹 애플리케이션
├── sql_grader_agent.py       # SQL 채점 에이전트
├── sql_utils.py              # 공통 유틸리티 함수
├── ecommerce.db              # SQLite 데이터베이스
└── README_CHATBOT.md         # 이 파일
```

## 기술 스택

- **Gradio 5.x**: 웹 UI 프레임워크
- **SQLite3**: 데이터베이스
- **Python 3.8+**: 백엔드 로직

## 고급 기능 (향후 추가 예정)

- [ ] LangGraph supervisor 패턴 적용
- [ ] LLM 기반 쿼리 분석 및 개선 제안
- [ ] 더 많은 문제 추가
- [ ] 난이도별 문제 분류
- [ ] 사용자 진행 상황 저장
- [ ] 리더보드 및 순위

## 문제 해결

### 포트가 이미 사용 중인 경우

```python
# app.py 마지막 부분 수정
demo.launch(
    server_name="0.0.0.0",
    server_port=7861,  # 다른 포트로 변경
    share=False
)
```

### 데이터베이스 파일이 없는 경우

```bash
# 먼저 데이터베이스 생성
uv run python setup_database.py
```

## 라이선스

이 프로젝트는 학습 목적으로 자유롭게 사용할 수 있습니다.
